// Generated by CoffeeScript 1.6.1
/*
mintpresso-0.2.coffee

Author: Jinhyuk Lee <eces at mstock.org>
Organization: MINTPRESSO <support at mintpresso.com>
Repository: https://github.com/mintpresso/javascript-api

Description:
  This is a JavaScript API library for MINTPRESSO Data Cloud.
  Supports basic graph operations.

Documentation: docs.mintpresso.com/javascript-api/index.html
*/(function(){var e,t,n,r,i,s,o,u,a,f;String.prototype.format===void 0&&(String.prototype.format=function(){var e;e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return typeof e[n]!="undefined"?e[n]:t})});String.prototype.endsWith=function(e){return this.substr(this.length-e.length)===e};String.prototype.startsWith=function(e){return this.substr(0,e.length)===e};try{a={log:"[MINTPRESSO] ",version:"/v1"};n={name:"JS 0.2 API",key:"",id:"",useDebugCallback:!0,getAPI:function(){return"api_token="+n.key}};f={list:[],iteration:0,get:function(){return f.list[f.iteration]},isReady:!1,timeout:5e3,urls:{getPoint:"/account/{0}/point/{1}?",getPointByTypeOrIdentifier:"/account/{0}/point?type={1}&identifier={2}&",addPoint:"/post/account/{0}/point?updateIfExists={1}&",findEdge:"/account/{0}/edge?subjectId={1}&subjectType={2}&subjectIdentifier={3}&verb={4}&objectId={5}&objectType={6}&objectIdentifier={7}&getInnerModels={8}&",linkWithEdge:"/post/account/{0}/edge?subjectId={1}&subjectType={2}&subjectIdentifier={3}&verb={4}&objectId={5}&objectType={6}&objectIdentifier={7}&getInnerModels={8}&"},dataType:"jsonp",useCallback:!0,callbackName:"JSAPIMINTPRESSOCALLBACK"};r={pageTracker:!1};u={verbs:new Array("do","does","did","verb"),mark:"?",point:{prototype:new Array("type","identifier","data")},edge:{prototype:new Array("subjectId","subjectType","verb","objectId","objectType")}};s=function(e,t){return jQuery.ajax({url:f.get()+a.version+f.urls.getPoint.format(n.id,e)+n.getAPI(),type:"GET",async:!0,cache:!1,crossDomain:!0,dataType:f.dataType,jsonpCallback:f.callbackName,timeout:f.timeout,success:function(e){var n,r;n=void 0;if(e.status.code===200&&e.point.data!==void 0){for(r in e.point.data)r!=="data"?e.point[r]=e.point.data[r]:n=e.point.data[r];n===void 0?delete e.point.data:e.point.data=n}return t(e)},error:function(e,n,r){console.error(""+a.log+" Response("+n+") "+r);return t({status:{code:n,message:"Response("+n+") "+r}})}})};o=function(e,t){var r,i,s,o;r=0;o="";s="";for(i in e){if(r>0){console.log(""+a.log+"Too many arguments are given to be an informative query though no question marks are found - mintpresso.get");break}if(i.length===0||i!==u.mark)o=encodeURIComponent(i);if(e[i].length===0||e[i]===u.mark){console.log(a.log+(""+a.log+"No question mark is allowed on 'identifier' field - mintpresso.get"));return!1}s=encodeURIComponent(e[i]);r++}return jQuery.ajax({url:f.get()+a.version+f.urls.getPointByTypeOrIdentifier.format(n.id,o,s)+n.getAPI(),type:"GET",async:!0,cache:!1,crossDomain:!0,dataType:f.dataType,jsonpCallback:f.callbackName,timeout:f.timeout,success:function(e){var n,s,o,u;n=void 0;if(e.status.code===200)if(e.point!==void 0){if(e.point.data!==void 0){for(i in e.point.data)i!=="data"?e.point[i]=e.point.data[i]:n=e.point.data[i];n===void 0?delete e.point.data:e.point.data=n}}else if(e.points!==void 0)for(r=o=0,u=e.points.length-1;o<=u;r=o+=1){s=e.points[r];if(s.data!==void 0){for(i in s.data)i!=="data"?e.points[r][i]=s.data[i]:n=s.data[i];n===void 0?delete e.points[r].data:e.points[r].data=n}}else console.error(a.log+"Found results neither point nor points - mintpresso._getPointByTypeOrIdentifier");return t(e)},error:function(e,n,r){console.error(""+a.log+" Response("+n+") "+r);return t(JSON.parse(e.responseText))}})};i=function(e,t,r){var i,s,o,l,c,h,p,d,v;r==null&&(r=!1);i=1;d="";h=-1;p="";v="";c="";o=-1;l="";for(s in e){switch(i){case 1:d=encodeURIComponent(s);e[s]!==u.mark&&typeof e[s]=="number"&&(h=encodeURIComponent(e[s]));e[s]!==u.mark&&typeof e[s]=="string"&&(p=encodeURIComponent(e[s]));break;case 2:u.verbs.indexOf(s)===-1?console.log(a.log+"Verb isn't match with do/does/did/verb. - mintpresso.get"):e[s]!==u.mark&&(v=encodeURIComponent(e[s]));break;case 3:c=encodeURIComponent(s);e[s]!==u.mark&&typeof e[s]=="number"&&(o=encodeURIComponent(e[s]));e[s]!==u.mark&&typeof e[s]=="string"&&(l=encodeURIComponent(e[s]));break;default:console.log(a.log+"Too many arguments are given to be a form of subject/verb/object query - mintpresso.get");return!1}i++}return jQuery.ajax({url:f.get()+a.version+f.urls.findEdges.format(n.id,h,d,p,v,o,c,l,r)+n.getAPI(),type:"GET",async:!0,cache:!1,crossDomain:!0,dataType:f.dataType,jsonpCallback:f.callbackName,timeout:f.timeout,success:function(e){return t(e)},error:function(e,n,r){console.error(""+a.log+" Response("+n+") "+r);return t(JSON.parse(e.responseText))}})};t=function(e,t,r){var i,s;r==null&&(r=!1);s={};s.point={};s.point.data={};for(i in e)u.point.prototype.indexOf(i)!==-1?s.point[i]=e[i]:s.point.data[i]=e[i];return jQuery.ajax({url:f.get()+a.version+f.urls.addPoint.format(n.id,encodeURIComponent(JSON.stringify(s),r))+n.getAPI(),type:"GET",async:!0,cache:!1,crossDomain:!0,dataType:f.dataType,jsonpCallback:f.callbackName,timeout:f.timeout,success:function(e){return t(e)},error:function(e,n,r){console.error(""+a.log+" Response("+n+") "+r);return t(JSON.parse(e.responseText))}})};e=function(e,t){var r,i,s;s={};s.edge={};r=1;for(i in e){switch(r){case 1:i!==u.mark&&u.edge.prototype.indexOf(i)===-1&&(s.edge.subjectType=i);e[i]!==u.mark&&(s.edge.subjectId=e[i]);break;case 2:u.verbs.indexOf(i)===-1?console.log(""+a.log+" Verb isn't match with do/does/did/verb. - mintpresso.set"):s.edge.verb=e[i];break;case 3:i!==u.mark&&u.edge.prototype.indexOf(i)===-1&&(s.edge.objectType=i);e[i]!==u.mark&&(s.edge.objectId=e[i]);break;default:console.log(""+a.log+" Too many arguments are given to be a form of subject/verb/object query - mintpresso.set");return!1}r++}return jQuery.ajax({url:f.get()+a.version+f.urls.linkWithEdge.format(n.id,encodeURIComponent(JSON.stringify(s)))+n.getAPI(),type:"GET",async:!0,cache:!1,crossDomain:!0,dataType:f.dataType,jsonpCallback:f.callbackName,timeout:f.timeout,success:function(e){return t(e)},error:function(e,n,r){console.error(""+a.log+" Response("+n+") "+r);return t(JSON.parse(e.responseText))}})};window.mintpresso={};window.mintpresso={get:function(){var e,t,n,r,u,l;if(f.isReady===!1)return console.warn(""+a.log+"Not initialized. Add mintpress.init in your code with API key.");if(arguments.length===0)return console.warn(""+a.log+"An argument is required for mintpresso.get method.");if(arguments.length<=2){n=!1;arguments[2]!==void 0&&"string"?n=!0:n=!1;arguments[1]!==void 0&&typeof arguments[1]=="function"?e=arguments[1]:e=window.mintpresso.callback;if(typeof arguments[0]=="number")return s(arguments[0],e);if(typeof arguments[0]=="object"){u=arguments[0];r=!1;t=0;for(l in u){t++;if(l==="?"||u[l]==="?")r=!0}return r&&t>1||t===3?i(arguments[0],e,n):o(arguments[0],e)}return console.warn(""+a.log+" An argument type of Number or String is required for mintresso.get method.")}return console.warn(""+a.log+" Too many arguments in mintpresso.get method.")},set:function(){var n,r,i,s;if(f.isReady===!1)return console.warn(""+a.log+"Not initialized. Add mintpress.init in your code with API key.");if(arguments.length===0)console.warn(""+a.log+"An argument is required for mintpresso.set method.");else if(arguments.length<=3)if(typeof arguments[0]=="object"){r=!1;for(i in arguments[0])if(u.verbs.indexOf(i)!==-1){r=!0;break}s=!1;n=window.mintpresso.callback;if(arguments[1]!==void 0&&typeof arguments[1]=="function"){n=arguments[1];arguments[2]!==void 0&&typeof arguments=="boolean"&&(s=!0)}r===!0?e(arguments[0],n):arguments[1]===void 0||arguments[1]===!1?t(arguments[0],n,s):t(arguments[0],n,s)}else console.warn(""+a.log+"An JSON object is required for mintpresso.set method.");else console.warn(""+a.log+"Too many arguments in mintpresso.get method.");return!0},callback:function(e){var t;if(n.useDebugCallback===!0)return(e!=null?(t=e.status)!=null?t.code:void 0:void 0)>201?console.log(""+a.log+"Response("+e.status.code+"): "+e.status.message,e):console.log(""+a.log+"Response("+e.status.code+"): ",e)},init:function(e,t,r){var i;if(typeof e!="string")return console.warn(""+a.log+" Not initialized. Invalid API key. (required: String)");n.key=e;n.id=t;if(r.withoutCallback!==void 0&&r.withoutCallback===!0){f.dataType="json";f.callbackName=void 0;f.useCallback=!1}else f.useCallback=!0;i="//api.mintpresso.com";if(r.useLocalhost!==void 0&&r.useLocalhost===!0){console.log(""+a.log+"Using localhost server (http://localhost:15100)");i="//localhost:15100"}"https:"===document.location.protocol?f.list.push("https:"+i):f.list.push("http:"+i);if(r.callbackFunction!==void 0&&r.callbackFunction.length>0&&r.callbackFunction in window){window[r.callbackFunction](window.mintpresso);console.log(""+a.log+"window."+r.callbackFunction+" is called.")}r.disableDebugCallback!==void 0&&r.disableDebugCallback===!0?n.useDebugCallback=!1:n.useDebugCallback=!0;f.isReady=!0;return!0}}}catch(l){if(window.mintpresso!==void 0&&!0)throw l;console.warn(""+a.log+" Failed to load API.")}!0}).call(this);